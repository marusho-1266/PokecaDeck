# 初手練習機能 実装計画

## 概要
取得したデッキ情報から、ポケモンカードゲームの初手（対戦準備）の練習が行える機能を実装します。

## 機能要件

### 1. 基本機能
- デッキからランダムに7枚を引く（手札）
- 【たね】ポケモンが手札にあるかチェック
- バトルポケモンを選択（【たね】ポケモンから1枚）
- ベンチポケモンを選択（任意、【たね】ポケモンから最大5枚まで）
- サイドを6枚置く
- リドロー機能（【たね】ポケモンがない場合）

### 2. UI要件
- 手札エリア（7枚のカードを表示）
- バトル場エリア（選択したバトルポケモンを表示）
- ベンチエリア（選択したベンチポケモンを表示、最大5枚）
- サイドエリア（6枚のカードを表示）
- 山札エリア（残りのカード枚数を表示）
- 「初手を引く」ボタン
- 「リドロー」ボタン（【たね】ポケモンがない場合に表示）
- 「リセット」ボタン

### 3. ルール実装

#### 3.1 対戦準備の手順（ルールガイド G 対戦準備より）
1. 山札を置く（デッキをシャッフル）
2. 手札を7枚引く
3. バトルポケモンを出す
   - 手札に【たね】ポケモンがある場合：その中から1枚選んでバトル場に出す
   - 手札に【たね】ポケモンがない場合：リドロー処理
4. ベンチポケモンを出す（任意）
   - 手札に残っている【たね】ポケモンから最大5枚までベンチに出す
5. サイドを置く
   - 山札から6枚をサイドに置く

#### 3.2 リドロー処理
- 【たね】ポケモンが手札にない場合：
  1. 手札をすべて山札に戻す
  2. 山札をシャッフル
  3. 手札を7枚引く
  4. 再度【たね】ポケモンのチェック

## 技術的な課題と解決策

### 課題1: 【たね】ポケモンの判定
**問題**: 現在のデッキ情報には【たね】ポケモンかどうかの情報が含まれていない可能性がある

**解決策**:
- カード名やカテゴリから推測する（カテゴリが「ポケモン」の場合）
- カード詳細ページから進化マークを取得する（将来的な拡張）
- ユーザーに手動で選択させる（暫定対応）

**暫定実装**:
- カテゴリが「ポケモン」のカードをすべて【たね】ポケモンとして扱う
- 将来的にはカード詳細情報から進化マーク（【たね】/【1進化】/【2進化】）を取得して正確に判定

### 課題2: カードのシャッフル
**解決策**:
- JavaScriptのFisher-Yatesアルゴリズムを使用してランダムにシャッフル

### 課題3: カードの状態管理
**解決策**:
- フロントエンドでカードの状態（山札、手札、バトル場、ベンチ、サイド）を管理
- 各カードに一意のIDを付与して状態を追跡

## 実装ステップ

### Phase 1: 基本機能の実装
1. デッキ情報を保持する状態管理
2. カードのシャッフル機能
3. 手札を7枚引く機能
4. 基本的なUI（手札エリアの表示）

### Phase 2: ポケモン配置機能
1. 【たね】ポケモンの判定（暫定実装）
2. バトルポケモン選択機能
3. ベンチポケモン選択機能
4. サイド配置機能

### Phase 3: リドロー機能
1. リドローの判定（【たね】ポケモンがない場合）
2. リドロー処理の実装
3. リドロー回数の制限（オプション）

### Phase 4: UI改善
1. カードのドラッグ&ドロップ対応（オプション）
2. カードの画像表示
3. アニメーション効果
4. レスポンシブデザイン

### Phase 5: 統計機能（オプション）
1. 初手の統計情報（【たね】ポケモンが引ける確率など）
2. 複数回の初手練習の記録

## ファイル構成

### 新規作成ファイル
- `public/opening-hand-practice.js` - 初手練習機能のメインロジック
- `public/opening-hand-practice.css` - 初手練習機能のスタイル

### 修正ファイル
- `public/index.html` - 初手練習セクションの追加
- `public/app.js` - デッキ情報取得後に初手練習機能を有効化
- `public/style.css` - 初手練習機能のスタイル追加

## データ構造

### カード状態
```javascript
{
  cardId: string,
  name: string,
  category: string,
  count: number,
  imageUrl: string,
  state: 'deck' | 'hand' | 'battle' | 'bench' | 'prize', // カードの状態
  isBasicPokemon: boolean // 【たね】ポケモンかどうか
}
```

### ゲーム状態
```javascript
{
  deck: Array<Card>, // 山札
  hand: Array<Card>, // 手札（最大7枚）
  battlePokemon: Card | null, // バトルポケモン
  bench: Array<Card>, // ベンチ（最大5枚）
  prize: Array<Card>, // サイド（6枚）
  mulliganCount: number // リドロー回数
}
```

## UIデザイン案

### レイアウト
```
┌─────────────────────────────────────┐
│  デッキ情報表示エリア                │
├─────────────────────────────────────┤
│  山札: XX枚                          │
│  [初手を引く] [リドロー] [リセット] │
├─────────────────────────────────────┤
│  手札エリア（7枚）                   │
│  [カード] [カード] ...               │
├─────────────────────────────────────┤
│  バトル場: [選択したポケモン]        │
├─────────────────────────────────────┤
│  ベンチ: [ポケモン] [ポケモン] ...   │
│  （最大5枚）                          │
├─────────────────────────────────────┤
│  サイド: [カード] [カード] ...       │
│  （6枚）                              │
└─────────────────────────────────────┘
```

## 注意事項

1. 【たね】ポケモンの判定は暫定実装のため、将来的にカード詳細情報から正確に判定する必要がある
2. リドロー回数の制限は実装しない（練習用のため）
3. カードの画像が取得できない場合のフォールバック処理が必要
4. モバイルデバイスでも使いやすいUIを考慮する

## 今後の拡張案

1. カード詳細情報から進化マークを取得して正確な【たね】判定
2. 初手の統計情報（【たね】ポケモンが引ける確率、特定のカードが引ける確率など）
3. 複数の初手パターンの比較
4. 初手の評価機能（良い初手/悪い初手の判定）
5. 初手の保存・共有機能
